Charmhigh CHMT48VB Pick-and-Place DPV file format specification- Updated December 21, 2024 - send any corrections and improvements to info at HdsSystems.com- CHMT V2.5
  * Later 2016 - v0 DPV file format was apparently first version of file format
    - Documentation seems to pertain to v0 file format based on UI items presented in manuals
  * Unknown date - v1 DPV file format
    - Used by currently shipping software
    - Appears to have taken place without updating CHMT version number or documentation
    - UI on shipped machine is different from documented UI- The Charmhigh CHMT48VB system appears to be a “mature” product with no further development taking place- The Charmhigh CHMT48VB software has many bugs, incoherent error messages, poorly designed features- Vendor documentation is poorly written and has many errors - all documentation dating from 2016- Vendor does not publish the DPV file format specification- Vendor support is mostly non-existent- The following is from reverse engineering needed to make the Charmhigh CHMT48VB work
  * This document is known to be incomplete for lack of knowledge - accuracy is not guaranteed
  * I have tried to point out most of the unknowns- General data format
  * Blank lines are ignored
  * Any line starting with an unrecognized keyword is ignored
    - For visual appearance, start a keyword with # to denote a data line to be ignored - i.e., a comment line
  * Tables have a header line followed by one or more data lines
    - Table header lines are ignored - they are generated by the software for human readers only
  * Data lines are a list of comma-separated fields
    - The first field in a data line names the data contents
    - The second field in a data line specifies the data sequence number - i.e., 0 to N-1
  * Fields may contain white space - generally ignored - useful for formatting description fields
  * Numbers
    - [<negative-sign>]<integer>[<decimal-point><integer>]
    - Decimal fraction is truncated after 2 significant digits - remaining digits are ignored
  * Coordinates and distances/offsets are in millimeters
    - Standard Cartesian coordinate system - X axis is left/right. Y axis is front/back, all locations must be positive
      * Bottom references closer to the front of the machine while top references closer to the back of the machine
      * Machine coordinate system: 0,0 is at the travel stops at the forward left corner
        - Coordinates (Diagnostics, Move) are referenced to calibrated camera center position
        - Used for everything except PCB locations
      * PCB coordinate system: 0,0 is at the board stop notch on the front board support
        - Used for all board locations
  * Times are in centiseconds (i.e., 1/100th of a second)
  * Angles are in degrees
    - Positive values are counter-clockwise, negative values are clockwise
    - Values range from 180 to -180- Cameras
  * Calibrate using two-sided target under System Set
    - Stored in system parameters - cleared by factory reset
  * Set visual system part parameters in Run, MStack, Edit, Visual Parameters
    - Up camera has a resolution of about 20 pixels per mm
    - Visual parameters stored in Station data
    - Set nozzle prior to setting visual parameters in Run, MStack, Edit, Nozzle - Station data does not have a nozzle field
    - In Visual Parameter window, select Move Head to Up Camera button to position selected nozzle over camera
    - Manually put part on nozzle and then set the threshold and visual ratio
      * Part pixel size shown in upper right field block, saved to Station data
  * Note: the pull needle is about 20mm in back of the down camera
  * Note: the nozzles are about 18mm in front of the down camera- Nozzles
  * Two nozzles are supported, referenced as #1 (left) and #2 (right)
  * Juki brand 500 series nozzles
  * 502 - Ø 0.7 mm - 0402
    - Can also pick up 0603, 0805, 1206, SC-75 and SOT23
  * 503 - Ø 1.0 mm - 0603
    - Can also pick up 0402, 0805, 1206, SC-75 and SOT23
  * 504 - Ø 1.5 mm - 0805, 1206, SOT23
  * 505 - Ø 3.5 mm, rubber tip - SOP8, SOP14, 3535 LEDs, SSOP
  * 506 - Ø 5.0 mm, rubber tip - QFN, TQFP
  * Calibrate both nozzle centers under System Set
    - Stored in system parameters - cleared by factory reset
  * Note: visual system requires green nozzles - do not use black
  * Note: the two nozzles are separated by about 23mm
  * Note: the bottom of the nozzles are about 31mm above the machine base
  * Note: the nozzles are about 38mm in front of the pull needle- Reel set A (1 to 29) and set B (36 to 64)
  * 22 - 8mm tape reels
  * 3 - 12mm tape reels
  * 3 - 16mm tape reels
  * 1 - 24mm tape reel
  * 1/2” axle rod (not supplied)
    - Recommended for smooth operation
    - Wood dowel will work, cut to fit between end plates - add keepers to ends
  * Reel separator sheets (not supplied)
    - Thin plastic sheet with notches for reel frame and hole for axle rod
    - Separates reels - adjacent reel spokes can bind if warped
  * Calibrate pull needle under System Set
    - Move tape manually for X alignment
    - Use up/down arrows for Y alignment
    - Stored in system parameters - cleared by factory reset
    - Note: bottom of retracted pull needle is about 25mm above machine base - lowest point on head
    - Note: the nozzles are about 38mm in front of the pull needle
  * Calibrate tape pocket location under File, Edit, MStack, Edit, Coordinate Set
    - Calibration offsets stored in P&P file in Station data in DeltX and DeltY columns
    - Switch from Vision to Head to access pull needle button to move tape one part
      * Make sure reels move smoothly when tape is pulled - there must be no tape movement at end of pull
    - Switch back to Vision to verify/fix resulting pocket alignment
      * Test multiple parts on tape (3 to 5)
    - Save between stations
    - Note: you can copy/paste this data to other files - if you change something, you must update all files- Built in front parts tray
  * 14 - ICs, etc - one part per ID
    - IC stack 71 to 77 - top row L to R - 7 pockets
    - IC stack 78 to 83 - bottom row L to R - 6 pockets
    - IC stack 84 - long vertical pocket on right
    - Pocket bottom Z is 19mm above machine base- Optional vibratory feeders
  * Stack 85 to 90
  * No documentation for how these are used- Optional IC trays
  * IC stack 91 to 99
  * Each stack defines a separate tray
    - Tray pockets are numbered 0 to N-1
    - Note: one physical tray can be subdivided into multiple virtual trays
  * For medium to larger parts
  * Rows/columns must align to the machine coordinate system
  * Calibrate first and last part location under File, Edit, IC Tray, First/Last Position
    - Locations are stored in P&P file in ICTray table
  * The tray area
    - Bracketed by the two inner guide rods - left edge X of 195 and right edge X of 365
      * The center of the machine coordinate system is at 280
      * Allow an additional 10mm on each side for the tray corner brackets - i.e., 185 for left and 355 for right
      * Tray width should not exceed 170mm
    - Maximum Y (nozzle location) is 440 - this is the maximum last part center Y location for an IC tray
    - Minimum Y depends on the back board support position
    - The IC tray pocket bottom Z should be 19mm above machine base - same Z as front trays- Circuit board location
  * The circuit board coordinate system 0,0 is at machine coordinate 110,80
    - The center of the circuit board coordinate system is at 170,0
  * The top of a standard 0.0625” (1.6mm) circuit board is 20mm above the machine base
  * Calibrate using 3 fiducial locations - UL, LR and LL
    - Bug: you must define at least 2 components (EComponent data rows) to get the LR fiducial location to calibrate
      * Second component can be a no place skip part
    - Enable 3 point calibration feature under System Set
      * Supersedes hard board stop
        - Don’t set board 0,0 location when using 3-point calibration
      * In theory, this will compensate for misalignment issues - offset, skew, rotation, scale
        - PCB can be located anywhere within placement area by using 3-point calibration - e.g., centered instead of left aligned
      * Calibration offsets stored in CalibPoint data in DevX and DevY columns
        - Define CalibPoint data in UL, LR and LL order
      * Preset DevX if centering board (i.e., set initial value to centering offset) to speed up calibration
    - Recommendation: use 3 part locations instead of separate fiducial marks - especially with large panels
    - Additional information stored in P&P file in CalibFactor data
      * CalibFactor data is generated by system, appears to reference machine coordinate system- Setup summary
  * Under Set
    - Turn off Detect Vacuum
    - Turn on Visual Assist
    - Turn on Visual Component Detect
    - Turn on Detect Z-Axis - what this does is not clear - documentation said to keep it on
    - Run speed for whole machine should be between 80% and 100% - not below 80%
  * Under Set, System Set
    - Turn off Use system stack offsets
    - Turn on Use 3 points to calibrate
    - Calibrate Up/Down Camera position
    - Calibrate Nozzle 1 and 2 positions
    - Calibrate Pull Needle Y axis station positions - set X axis positions manually
  * Under Run, Edit, MStack, Edit
    - For each used reel location, calibrate the pocket position
  * Under Run, Edit, IC Tray
    - For each tray locaton, calibrate the first and last part center position
  * Under Run, Edit, PCB Calibrate
    - Calibrate the UL, LR and LL fiducial positions
The DPV file is composed of several sections.  Each section serves a particular purpose.  A section only needs to be specified if that feature is needed.- Header- Station - material stack (part source) table
  * Identifies parts at each location - reel location, front IC tray location, optional rear IC tray location(s)
  * All parts sourced from a location must be identical
  * Options
    - Skip or place part
    - Empty condition - pause or move to next station
    - Vision assist
    - Vacuum assist- ICTray  - IC tray (part source) table
  * Location and layout of each IC tray
    - X,Y of first/last cell centers (LL/UR corners) and tray column/row counts
  * Specify starting position - allows earlier positions to be skipped- Panel_Coord - PCB location table
  * A method to create N-up array without requiring equal spacing
  * Specifies 0,0 location of individual boards to be populated
  * Can work mechanically for one row of same size boards
  * Cannot use 3 point panel calibration with this method- Panel_Array - PCB array table
  * A method to create N-up array with equal spacing
  * All part data is referenced to board #1 (lower left of panel)
  * Specify boards to be excluded from array
  * Use 3 point panel calibration- EComponent - PCB part table
  * Location of parts on PCB- PcbCalib - PCB calibration table
  * No clue what this table does- CalibPoint - calibration point table
  * Board (panel) fiducial alignment points - UI only supports 3 points - UL, LL and LR
    - It is recommended you use 3 corresponding parts instead of separate fiducial marks- CalibFator - calibration factor table
  * Appears to map the the board coordinate system to the machine coordinate system with corrections for calibration
A generated file should have only the required elements in the file.  Elements that require calibration are normally set to zero - but may be estimated to speed 
up calibration.  Note that the header column names are the names the system uses when writing out updated data to a file.  More mnemonic names - and 
more accurate names - can be used when generating the original file.
The header is composed of the following data lines:- A single line with the literal text “separated”.
  * Not sure what this line means- A single line with “FILE,” and a file specification: <file-name>.dpv
  * Must accurately match file name- A single line with “PCBFILE,” and a file name: <file-name>
  * Name of original CSV file used to create DPV file
  * In general, the same as DPV file name
  * If no CSV file, use DPV file name with DPV extension- A single line with “DATE,” and a date: <yyyy>/<mm>/<dd>
  * Creation date of this file- A single line with “TIME,” and a time: <hh>:<mm>:<ss>
  * Creation time of this file, 24 hour format- A single line with “PANELYPE,” and a format version code: <n>
  * 0 - appears to be the original file format used in example files
  * 1 - appears to be the current file format
Station - material stack (part source) table.  Each data row represents one reel position, one front IC tray position or one parts tray position.- Column title: “Table”, column data: “Station”- Column title: “No.”, column data: <table-row-number>
  *The data lines must be numbered sequentially from 0 to N-1- Column title: “ID”, column data: <part-station-number>
  * Best practice is to put in numeric order - not required
  * Omit unused positions- Column title: “DeltX”, column data: <x-part-pocket-offset>
  * Calibrated X offset from default tape part cavity center- Column title: “DeltY”, column data: <y-part-pocket-offset>
  * Calibrated Y offset from default tape part cavity center- Column title: “FeedRates”, column data: <feed-distance>
  * Distance between two adjacent components on tape - e.g., 2, 4, 8
  * Ignored when using ICTray or front IC trays- Column title: “Note”, column data: <description>
  * Identify the part - typically part value and package type or vendor part designation- Column title: “Height”, column data: <part-height>
  * The height of the part - controls how far down nozzle must go to pick up a part
    * In general, you must specify small values to ensure pickup from tray pockets at 19mm Z above machine base
  * Maximum part height is 5mm
    - Allows about 1mm clearance for the pull needle - the lowest point on the head
    - Assumes standard 0.0625” (1.6mm) board - top is 20mm above machine base
    - Parts will still collide (placed part and new part being placed) if conditions are not perfect
    - Will not pick up a 5mm part unless height is set to a much smaller value
      * Tested on front tray pockets at 19mm Z above machine base- Column title: “Speed”, column data: <transport-speed-percentage>
  * Transport speed (source to board) as percentage - not below 50%, 0 is 100%
  * See also Run Speed under Set UI- Column title: “Status”, column data: <flags>
  * 1 to skip component, 0 to place component
  * 2 to use vacuum status to verify part picked up, 0 to ignore vacuum status when picking up part
    - Generally, leave this flag off
    - See also Vacuum detection in Set UI - documentation says to turn it off - this must be on for this flag to work
    - See also Visual lack detect in Set UI - documentation says to turn it on
  * 4 to place part using vision (slower, more accurate), 0 to place part without vision (faster, less accurate)
    - Generally, leave this flag on
    - See also Visual assist in Set UI - documentation says to turn it on - this must be on for this flag to work
    - See also Vacuum detection in Set UI - documentation says to turn it off
  * 8 to mount separately – i.e., pause when station runs out of parts, 0 to move to next station when this station runs out of parts- Column title: “SizeX”, column data: <x-size-mm> - V0
  * Width (X) of component in millimeters- Column title: “nPixSizeX”, column data: <x-size-pix> - V1
  * Width (X) of component in pixels or 0
  * See visual system parameters- Column title: “SizeY”, column data: <y-size-mm> - V0
  * Depth (Y) of component in millimeters- Column title: “nPixSizeY”, column data: <y-size- pix> - V1
  * Depth (Y) of component in pixels or 0
  * See visual system parameters- Column title: “HeightTake”, column data: <unknown>
  * Unknown - not documented, not figured out, does not appear to do anything- Column title: “DelayTake”, column data: <pickup-delay>
  * Time in centiseconds to delay part pickup after head is positioned
  * 10cs may be a good default- Column title: “nPullStripSpeed”, column data: <speed-percentage> - V1
  * Tape pull speed as a percentage, 0 for full speed
  * Not documented - there may be a minimum speed like other speed parameters
  * Heavy reels need slower speed
  * 85% may be a good default- Column title: “nThreshold”, column data: <threshold> - V1
  * Threshold for detecting part edges or 0
  * Default is 110, range is 1 to 256
  * See visual system parameters- Column title: “nVisualRadio”, column data: <ratio> - V1
  * Ratio between part size and search box when looking for edges as a percentage or 0
  * Default is 200%
  * See visual system parameters
ICTray - IC tray table.  Each data row represents one IC tray.- Column title: “Table”, column data: “ICTray”- Column title: “No.”, column data: <table-row-number>
  *The data lines must be numbered sequentially from 0 to N-1- Column title: “ID”, column data: <station-number>
  * The corresponding station number from the Station table- Column title: “CenterX”, column data: <tray-cavity-x-center>
  * Center X position of first tray cavity (position 0)
  * Calibrate under Run, Edit, IC Trays, First Position- Column title: “CenterY”, column data: <tray-cavity-y-center>
  * Center Y position of first tray cavity (position 0)
  * Calibrate under Run, Edit, IC Trays, First Position- Column title: “IntervalX”, column data: <tray-cavity-x-center>
  * Center X position of last tray cavity (position N-1)
  * Calibrate under Run, Edit, IC Trays, Last Position- Column title: “IntervalY”, column data: <tray-cavity-y-center>
  * Center Y position of last tray cavity (position N-1)
  * Calibrate under Run, Edit, IC Trays, Last Position- Column title: “NumX”, column data: <x-tray-columns>
  * Number of tray columns- Column title: “NumY”, column data: <y-tray-rows>
  * Number of tray rows- Column title: “Start”,  column data: <first-part-to-use>
  * Row major, left to right columns, bottom to top rows, 0 to N-1
  * Skips parts prior to first part
Panel_Coord - PCB panel table.  Each row represents a panel 0,0 location.  Appears to be ignored if CalibPoint table specified.- Column title: “Table”, column data: “Panel_Coord”- Column title: “No.”, column data: <table-row-number>
  *The data lines must be numbered sequentially from 0 to N-1- Column title: “ID”, column data: <panel-number>
  * Best practice is to put in numeric order - not required- Column title: “DeltX”, column data: <x-offset>
  * The X distance from machine zero to PCB zero- Column title: “DeltY”, column data: <y-offset>
  * The Y distance from machine zero to PCB zero
Panel_Array - panel array table.  The first data row specifies the array configuration while subsequent data rows specify table entries to be skipped.  The part 
locations for board 1 are specified by EComponent.  Note: boards are numbered 1 through N.- Column title: “Table”, column data: “Panel_Array”- Column title: “No.”, column data: <table-row-number>
  *The data lines must be numbered sequentially from 0 to N-1- Column title: “ID”, column data: <board-number>
  * 1 (first row) - table specification - specify remaining fields
  * N (additional rows) - board to skip
    - Row major, left to right columns, bottom to top rows, 1 to N
    - Remaining fields in row should be 0
- Column title: “IntervalX”, column data: <x-column-offset>
  * The X distance between table columns- Column title: “IntervalY”, column data: <y-row-offset>
  * The Y distance between table rows- Column title: “NumX”, column data: <x-count>
  * The number of table columns - columns are numbered left to right- Column title: “NumY”, column data: <y-count>
  * The number of table rows - rows are numbered bottom to top
PcbCalib - PCB calibration table.  Not sure what this represents but it seems to be system generated and have only one row of data.- Column title: “Table”, column data: “PcbCalib”- Column title: “No.”, column data: <table-row-number>
  *The data lines must be numbered sequentially from 0 to N-1- Column title: “nType”, column data: <???>
  * Not sure what this represents- Column title: “nAlg”, column data: <???>
  * Not sure what this represents- Column title: “nFinished”, column data: <???>
  * Not sure what this represents
CalibPoint - panel calibration points table.  Each row specifies a calibration point on the panel.  Only 3 points are supported by UI - first is UL on screen, 
second is LR on screen, third is LL on screen.  The UI also supports having the system pick 3 parts to represent those positions and defining the points for 
you.- Column title: “Table”, column data: “CalibPoint”- Column title: “No.”, column data: <table-row-number>
  *The data lines must be numbered sequentially from 0 to N-1- Column title: “ID”, column data: <calibration-point-number>
  * Best practice is to put in numeric order - not required- Column title: “offsetX”, column data: <x-coordinate>
  * Fiducial X location on board - optionally a part center- Column title: “offsetY”, column data: <y-coordinate>
  * Fiducial Y location on board - optionally a part center- Column title: “Note”, column data: <fiducial-name>
  * Fiducial name - suggested: UL, LR and LL - in that order- Column title: “Model”, column data: <??>
  * Does not appear to be used and can be left as 0- Column title: “Type”, column data: <??>
  * Does not appear to be used and can be left as 0- Column title: “DevX”, column data: <x-offset>
  * Distance from fiducial X to calibrated location
  * Initially 0 - filled in by system after fiducial calibration
  * Can be estimated to speed up calibration process if board is centered- Column title: “DevY”, column data: <Y-offset>
  * Distance from fiducial Y to calibrated location
  * Initially 0 - filled in by system after fiducial calibration
  * Can be estimated to speed up calibration process if board is centered
CalibFator - calibration factor table.  Appears to be created by the system after calibrating with the CalibPoint table.  The first three X/Y pairs appear to be the 
CalibPoint fiducial positions truncated to 2 decimal places and multiplied by 100.  The second 3 X/Y pairs appear to be relative to the machine coordinate 
system - but not sure how.- Table,No.,PCBX1,PCBY1,PCBX2,PCBY2,PCBX3,PCBY3,SMTX1,SMTY1,SMTX2,SMTY2,SMTX3,SMTY3,DeltaAngle- CalibFator,0,0,0,0,0,0,0,0,0,0,0,0,0,0
EComponent - component table.  Each data row represents one component position.- Column title: “Table”, column data: “EComponent”- Column title: “No.”, column data: <table-row-number>
  *The data lines must be numbered sequentially from 0 to N-1- Column title: “ID”, column data: <component-number>
  * Assumed best to put in numeric order - not sure if order required
  * Not sure what purpose this data serves- Column title: “PHead”, column data: <nozzle-number>
  * Pickup nozzle to use for picking up part - 1 or 2- Column title: “STNo.”, column data: <station-number>
  * The corresponding station number from the Station table- Column title: “DeltX”, column data: <x-coordinate>
  * Part X location on board- Column title: “DeltY”, column data: <y-coordinate>
  * Part Y location on board- Column title: “Angle”, column data: <part-rotation>
  * Part rotation angle - angle to rotate the part from the material stack and the board
  * Plus is counter-clockwise, minus is clockwise- Column title: “Height”, column data: <part-height>
  * Should match the Height field in the Station table- Column title: “Skip”, column data: <flags>
  * Should match the Status field in the Station table
 - Column title: “Speed”, column data: <speed>
  * Should match the Speed field in the Station table- Column title: “Explain”, column data: <part-designation>
  * Comment - normally used to specify the component identifier
- Column title: “Note”, column data: <part-information>
* Should match the Note field in the Station table- Column title: “Delay”, column data: <unknown>
* How long to wait before picking up the part
* Allows time for parts to stop moving before picking up a part
* 10ms seems like a good starting value
<< DPV example >>  - came from sample files - most values are completely bogus
separated
FILE,Sample DPV file.dpv
PCBFILE,CSV sample file
DATE,2018/01/31
TIME,00:58:01
PANELYPE,0 - V0
PANELYPE,1 - V1
Table,No.,ID,DeltX,DeltY,FeedRates,Note,Height,Speed,Status,SizeX,SizeY,HeightTake,DelayTake - V0
Station,0,1,0,0,4,AD2-C0805,0.5,0,4,0,0,0,0
Table,No.,ID,DeltX,DeltY,FeedRates,Note,Height,Speed,Status,nPixSizeX,nPixSizeY,HeightTake,DelayTake,nPullStripSpeed,nThreshold,nVisualRadio - V1
Station,0,1,0,0,4,AD2-C0805,0.5,0,4,0,0,0,0,0,0,0
Table,No.,ID,IntervalX,IntervalY,NumX,NumY
Panel_Array,0,1,10,10,8,7
Panel_Array,1,1,0,0,0,0
Table,No.,ID,DeltX,DeltY
Panel_Coord,0,1,0,0
Table,No.,ID,PHead,STNo.,DeltX,DeltY,Angle,Height,Skip,Speed,Explain,Note,Delay
EComponent,0,1,1,1,37.56,47.84,-90,0.5,4,0,C1,AD2-C0805,0
Table,No.,ID,CenterX,CenterY,IntervalX,IntervalY,NumX,NumY,Start
ICTray,0,99,214.28,51.78,358.53,51.78,1,7,0
Table,No.,nType,nAlg,nFinished
PcbCalib,0,0,0,0
Table,No.,ID,offsetX,offsetY,Note - V0
CalibPoint,0,0,0,0,UL loc - V0
CalibPoint,1,0,0,0,LR loc
Table,No.,ID,offsetX,offsetY,Note,Model,Type,DevX,DevY - V1
CalibPoint,0,1,0,0,UL loc,0,0,0,0 - V1
CalibPoint,0,1,0,0,LR loc,0,0,0,0
Table,No.,DeltX,DeltY,AlphaX,AlphaY,BetaX,BetaY,DeltaAngle - V0
CalibFator,0,0,0,0,0,1,1,0 - V0
Table,No.,PCBX1,PCBY1,PCBX2,PCBY2,PCBX3,PCBY3,SMTX1,SMTY1,SMTX2,SMTY2,SMTX3,SMTY3,DeltaAngle - V1
CalibFator,0,0,0,0,0,0,0,0,0,0,0,0,0,0 - V1
